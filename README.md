# Semiconductor-Defect-Prediction-Using-ML  
**반도체 센서 데이터를 활용한 결함 예측: 머신러닝과 차원 축소 기법을 이용한 접근**

---

## 1. 서론

반도체 제조 공정에서는 수많은 센서 데이터를 통해 제품 품질 관리 및 이상 탐지가 이루어집니다.  
그러나 이러한 데이터는 다음과 같은 문제점을 내포하고 있습니다.

- **고차원성**: 수백 개의 피처로 인해 차원의 저주(curse of dimensionality)가 발생할 수 있음.
- **클래스 불균형**: 정상(Pass)과 결함(Fail) 데이터 간의 비율 차이가 커 모델이 다수 클래스로 편향될 위험이 있음.
- **결측치 및 노이즈**: 센서 측정 과정에서 발생하는 결측치와 노이즈가 데이터 신뢰성을 저하시킴.
- **다중공선성**: 센서 데이터 간의 높은 상관관계로 인해 모델의 해석 및 일반화 성능에 악영향을 미칠 수 있음.

본 연구에서는 SECOM 데이터셋을 대상으로, 위 문제들을 해결하기 위한 통합 하이브리드 파이프라인을 제안합니다. 이 파이프라인은 데이터 전처리, SMOTE를 통한 오버샘플링, 통계 기반 피처 선택, 계층적 PCA를 이용한 차원 축소, 그리고 GridSearchCV를 통한 분류기 최적화를 포함합니다.

---

## 2. 관련 연구

반도체 제조 및 결함 탐지 분야에서는 다음과 같은 기법들이 사용되어 왔습니다.

- **데이터 전처리**: 결측치 보완, 단일 값 컬럼 제거, 다중공선성 문제 해결 등.
- **클래스 불균형 해결**: SMOTE와 같은 오버샘플링 기법을 이용해 소수 클래스 데이터를 증강.
- **차원 축소**: PCA 등 고차원 데이터의 노이즈 제거 및 주요 정보 보존.
- **하이브리드/앙상블 기법**: 여러 전처리 기법과 분류기를 결합하여 예측 성능을 향상시키는 연구.

본 연구는 위 기법들을 종합하여, 전처리부터 최적 분류기 선택까지 자동화된 통합 파이프라인을 제안합니다.

---

## 3. 제안 방법론

제안하는 방법론은 다음 네 단계로 구성됩니다.

### 3.1 데이터 전처리

- **결측치 처리**:  
  - 50% 이상 결측치가 있는 컬럼 제거 후, forward/backward fill 기법으로 나머지 결측치 보완.
- **단일 값 및 노이즈 제거**:  
  - 단일 값만 존재하는 컬럼 제거.
- **시간 데이터 및 다중공선성 제거**:  
  - "Time" 컬럼 제거.
  - 상관계수 0.7 이상인 피처 제거.
- **정규화**:  
  - StandardScaler를 사용하여 피처 정규화.
- **불균형 분포 시각화**:  
  - 타깃 변수(Pass/Fail)의 불균형을 시각화하여 문제 인식.

### 3.2 SMOTE를 이용한 오버샘플링

- **문제**: 정상과 결함 클래스의 불균형으로 인해 모델이 다수 클래스에 치우치는 문제가 발생.
- **해결 방법**: SMOTE를 적용하여 소수 클래스 데이터를 증강함.

### 3.3 차원 축소 및 피처 선택

두 가지 접근법을 사용합니다.

1. **PCA**:  
   - 전체 피처에 대해 PCA를 적용하여 노이즈 제거 및 차원 축소 수행.
2. **통계 기반 하이브리드 피처 선택 및 계층적 PCA**:  
   - Pearson 상관계수와 VarianceThreshold를 이용해 중요한 피처 선택.
   - 선택된 피처들을 Feature Agglomeration을 통해 클러스터링하고, 각 클러스터별로 PCA 수행.

### 3.4 분류기 선택 및 최적화

- **후보 분류기**:  
  - Decision Tree, Naive Bayes, Logistic Regression, K-NN, SVM, Neural Network(MLPClassifier)
- **GridSearchCV를 통한 최적화**:  
  - 파이프라인에 포함된 'hpca__n_clusters' 및 'classifier' 파라미터 조합을 평가하여 최적의 모델 선택.
  - 5-겹 교차검증을 통해 f1_macro 점수를 기준으로 최적 모델 도출.

---

## 4. 실험

### 4.1 데이터 전처리

- **데이터 개요**:  
  SECOM 데이터셋은 총 1567개의 샘플과 초기 592개의 피처로 구성됩니다.
- **처리 과정**:  
  - 50% 이상 결측치 컬럼 28개 제거, 단일 값 컬럼 116개 제거, "Time" 컬럼 제거  
  - 다중공선성 제거 후 최종 205개 피처 남음  
  - StandardScaler로 정규화  
  - 타깃 분포 시각화를 통해 Pass와 Fail의 불균형 확인

### 4.2 실험 설계

실험은 네 단계로 나누어 진행하였습니다.

1. **Step 1: 원본 데이터 (불균형)**  
   - 6개 분류기를 개별적으로 학습/평가하여 기본 성능 확인.
2. **Step 2: SMOTE 적용**  
   - SMOTE를 적용한 후 6개 분류기의 성능 비교.
3. **Step 3: SMOTE + PCA (차원 축소)**  
   - SMOTE 후 전체 피처에 PCA를 적용하여 차원 축소 효과 분석.
4. **Step 4: SMOTE + 통계 기반 피처 선택 + 계층적 PCA (최적화)**  
   - 통계 기반 피처 선택 및 계층적 PCA를 적용한 후, GridSearchCV로 6개 후보 분류기 중 최적 모델 선택.

### 4.3 하이퍼파라미터 선택

- **hpca__n_clusters**: [10, 15, 20]  
  - 계층적 PCA의 클러스터 수 조절로, 피처 그룹화를 최적화.
- **classifier**:  
  - 후보 분류기 6종 (Decision Tree, Naive Bayes, Logistic Regression, K-NN, SVM, Neural Network)을 모두 평가.
- GridSearchCV를 통한 최적화 결과, 최종적으로 Neural Network(MLPClassifier)가 선택되었으며, 최적의 hpca 클러스터 수는 10으로 결정되었습니다.

---

## 5. 실험 결과

### 5.1 Step 1: 원본 데이터 (불균형)
- **평균 성능**:  
  - Accuracy: 82.17%  
  - TPR: 20.14%  
  - FPR: 12.70%
- **분석**:  
  불균형으로 인해 소수 클래스에 대한 민감도가 낮음.

### 5.2 Step 2: SMOTE 적용
- **평균 성능**:  
  - Accuracy: 70.59%  
  - TPR: 38.19%  
  - FPR: 26.72%
- **분석**:  
  SMOTE로 소수 클래스 민감도(TPR)는 향상되었으나, 위양성률(FPR)이 증가함.

### 5.3 Step 3: SMOTE + PCA (차원 축소)
- **평균 성능**:  
  - Accuracy: 83.76%  
  - TPR: 25.00%  
  - FPR: 11.38%
- **분석**:  
  PCA로 차원을 축소하면서 노이즈를 제거하고 계산 복잡도를 낮춤. Accuracy와 FPR에서 개선 효과가 있음.

### 5.4 Step 4: SMOTE + 통계 기반 피처 선택 + 계층적 PCA (최적화)
- **최종 Hybrid Model 성능**:  
  - Accuracy: 89.17%  
  - TPR: 25.00%  
  - FPR: 5.52%
- **분석**:  
  통계 기반 피처 선택과 계층적 PCA를 통해 불필요한 피처를 제거하고 효과적인 차원 축소를 수행함으로써, Accuracy가 크게 향상되고 FPR이 현저히 감소함.
- **최적 분류기 확인**:  
  GridSearchCV 결과, 최종 선택된 분류기는 **MLPClassifier (Neural Network)**로 나타났습니다.
  
